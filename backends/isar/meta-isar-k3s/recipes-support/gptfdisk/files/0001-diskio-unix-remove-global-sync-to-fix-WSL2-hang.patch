From: isar-k3s <noreply@example.com>
Subject: [PATCH] diskio-unix: remove global sync() to fix WSL2 hang

The sync() syscall iterates ALL mounted filesystems to sync their data.
In WSL2, this includes 9p mounts for /mnt/c and similar Windows drives.
The 9p filesystem's sync implementation can hang indefinitely when
Windows has pending I/O or the mount is in a particular state.

This causes sgdisk/gdisk to hang at ~96% during WIC image generation
in ISAR builds on WSL2.

The sync() call is unnecessary because:
1. fsync(fd) is called immediately after on Linux, which syncs the
   specific disk file descriptor
2. The subsequent BLKRRPART ioctl ensures the kernel rereads the
   partition table

Removing sync() does not affect data integrity since fsync(fd)
ensures the partition table is written to the specific device.

Signed-off-by: isar-k3s <noreply@example.com>
---
 diskio-unix.cc | 1 -
 1 file changed, 1 deletion(-)

diff --git a/diskio-unix.cc b/diskio-unix.cc
index XXXXXXX..YYYYYYY 100644
--- a/diskio-unix.cc
+++ b/diskio-unix.cc
@@ -274,7 +274,6 @@ int DiskIO::DiskSync(void) {
    } // if

    if (isOpen) {
-      sync();
 #if defined(__APPLE__) || defined(__sun__)
       cout << "Warning: The kernel may continue to use old or deleted partitions.\n"
            << "You should reboot or remove the drive.\n";
