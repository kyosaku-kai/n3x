# =============================================================================
# Bonding + VLAN Network Profile - Full Production Parity
# =============================================================================
#
# TOPOLOGY:
#   eth1 --+
#          +-- bond0 --> bond0.200 (cluster)  - 192.168.200.0/24
#   eth2 --+         --> bond0.100 (storage)  - 192.168.100.0/24
#
# USAGE:
#   Deploy to /etc/netplan/60-k3s-network.yaml
#   Replace @CLUSTER_IP@ with cluster VLAN IP (e.g., 192.168.200.1)
#   Replace @STORAGE_IP@ with storage VLAN IP (e.g., 192.168.100.1)
#
# BONDING:
#   - Mode: active-backup (mode 1)
#   - Primary: eth1
#   - MII monitoring: 100ms
#
# VLAN IDs:
#   - VLAN 200: Cluster traffic (k3s API, flannel overlay)
#   - VLAN 100: Storage traffic (Longhorn, iSCSI)
#
# QEMU TEST NOTE:
#   - eth0: QEMU NAT for external access (used by backdoor/test driver)
#   - eth1, eth2: Bonded interfaces for k3s cluster
#
# =============================================================================

network:
  version: 2
  renderer: networkd

  ethernets:
    # Bond member interfaces - no direct config, managed by bond
    eth1: {}
    eth2: {}

  bonds:
    bond0:
      interfaces:
        - eth1
        - eth2
      parameters:
        mode: active-backup
        primary: eth1
        mii-monitor-interval: 100

  vlans:
    # Cluster VLAN on bond (k3s API, flannel)
    bond0.200:
      id: 200
      link: bond0
      addresses:
        - @CLUSTER_IP@/24

    # Storage VLAN on bond (Longhorn, iSCSI)
    bond0.100:
      id: 100
      link: bond0
      addresses:
        - @STORAGE_IP@/24
