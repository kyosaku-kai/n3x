# =============================================================================
# K3s Server Environment Configuration
# =============================================================================
#
# This file configures the K3s server (control plane) startup options.
# The K3S_SERVER_OPTS variable is passed to the 'k3s server' command.
#
# USAGE:
#   1. Uncomment and modify the options below as needed
#   2. Restart the service: systemctl restart k3s-server
#
# DOCUMENTATION:
#   Full list of server options: https://docs.k3s.io/cli/server
#
# TEST TOKEN:
#   A pre-configured test token is installed at:
#     /var/lib/rancher/k3s/server/token
#   WARNING: This is for testing only - production should use secure tokens
#   The server uses this token for agent authentication
#
# =============================================================================

# -----------------------------------------------------------------------------
# Kubeconfig Permissions
# -----------------------------------------------------------------------------
# By default, only root can read the kubeconfig. Set permissions to allow
# regular users to use kubectl without sudo.

# K3S_SERVER_OPTS="--write-kubeconfig-mode 644"

# -----------------------------------------------------------------------------
# Component Selection
# -----------------------------------------------------------------------------
# Disable built-in components if using alternatives (e.g., different ingress
# controller, external load balancer, etc.)

# Disable Traefik ingress controller:
# K3S_SERVER_OPTS="--disable traefik"

# Disable ServiceLB (formerly Klipper):
# K3S_SERVER_OPTS="--disable servicelb"

# Disable multiple components:
# K3S_SERVER_OPTS="--disable traefik --disable servicelb"

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
# Customize pod and service IP ranges (must be set before first start)

# K3S_SERVER_OPTS="--cluster-cidr 10.42.0.0/16 --service-cidr 10.43.0.0/16"

# Use a specific node IP (useful for multi-homed hosts):
# K3S_SERVER_OPTS="--node-ip 192.168.1.100"

# -----------------------------------------------------------------------------
# High Availability (HA) Configuration
# -----------------------------------------------------------------------------
# For production clusters, use an external datastore instead of embedded etcd

# PostgreSQL:
# K3S_SERVER_OPTS="--datastore-endpoint postgres://user:pass@host:5432/k3s"

# MySQL/MariaDB:
# K3S_SERVER_OPTS="--datastore-endpoint mysql://user:pass@host:3306/k3s"

# Embedded etcd with TLS:
# K3S_SERVER_OPTS="--cluster-init"

# -----------------------------------------------------------------------------
# Current Configuration
# -----------------------------------------------------------------------------
# Default: empty (use K3s defaults)

K3S_SERVER_OPTS=""
