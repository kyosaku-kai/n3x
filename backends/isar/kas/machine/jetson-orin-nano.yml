# NVIDIA Jetson Orin Nano machine configuration
# Usage: kas-container build kas/base.yml:kas/machine/jetson-orin-nano.yml:kas/image/minimal-base.yml
#
# Hardware notes:
# - Targets standard NVIDIA Orin Nano dev kit carrier board
# - Uses mainline 6.x kernel with minimal Tegra234 patches (per D1 decision)
# - L4T 5.15 available as fallback if needed
# - GPU support explicitly NOT required
# - Flash via jetpack-nixos fork with pluggable rootfs support

header:
  version: 14
  includes:
    - ../base.yml

machine: jetson-orin-nano
distro: debian-trixie

# Isar multiconfig target format: mc:{machine}-{distro_short}:{image}
target: mc:jetson-orin-nano-trixie:isar-image-base

local_conf_header:
  jetson-orin-nano: |
    # Jetson Orin Nano specific configuration
    # Use QEMU user-mode emulation (0) instead of cross-toolchain (1)
    # QEMU is more compatible but slower; cross-compile faster but may have issues
    ISAR_CROSS_COMPILE = "0"

    # NVIDIA L4T packages - baked into image for production-ready deployment
    # These provide nvbootctrl for A/B OTA updates and other essential tools
    # Downloaded directly from NVIDIA's Jetson apt repository as prebuilt .deb
    # SHA256 verified against jetpack-nixos sourceinfo/r36.4-debs.json
    IMAGE_INSTALL:append = " nvidia-l4t-core nvidia-l4t-tools"

    # Inherit L4T cross-build support class for NVIDIA package installation
    # This provides rootfs_create_l4t_marker function that bypasses nvidia-l4t-core's
    # preinst platform detection check (fails during cross-build without
    # /proc/device-tree/compatible). The function creates a marker file that
    # tells nvidia-l4t-core's preinst to skip hardware checks.
    INHERIT += "nvidia-l4t-cross-build"

    # JetPack 6.2 / L4T R36.4.4 is the latest for Orin Nano
