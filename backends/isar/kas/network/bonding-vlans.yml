# Bonding + VLANs Network Profile Overlay
# =============================================================================
#
# PURPOSE:
#   Configures k3s with bonded NICs (eth1+eth2) and VLANs on bond0.
#   Full production parity configuration.
#   - Bond mode: active-backup
#   - VLAN 200: Cluster traffic (k3s API, flannel)
#   - VLAN 100: Storage traffic (Longhorn, iSCSI)
#
# USAGE:
#   kas-container --isar build kas/base.yml:kas/machine/qemu-amd64.yml:kas/test-k3s-overlay.yml:kas/network/bonding-vlans.yml
#
# IP CONFIGURATION:
#   Default: 192.168.200.1 (cluster), 192.168.100.1 (storage)
#   Override with NETPLAN_CLUSTER_IP / NETPLAN_STORAGE_IP in local.conf
#
# NOTE:
#   QEMU test VMs must be configured with 3 NICs (eth0=NAT, eth1+eth2=bonded)
#   The nixos-test-driver handles this via qemuFlags
#
# =============================================================================

header:
  version: 14

local_conf_header:
  network-bonding-vlans: |
    # Bonding + VLANs network profile - full production parity
    IMAGE_INSTALL:append = " netplan-k3s-config"
    NETPLAN_PROFILE = "bonding-vlans"
    NETPLAN_CLUSTER_IP = "192.168.200.1"
    NETPLAN_STORAGE_IP = "192.168.100.1"
